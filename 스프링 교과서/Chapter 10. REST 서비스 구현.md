# Chapter 10. REST 서비스 구현

- REST 서비스는 클라이언트가 호출할 수 있는 엔드포인트를 이용하여 서버가 노출하는 기능에 액세스할 수 있게 해 준다.
- 이 주제는 모든 스프링 개발자가 반드시 배워야 할 내용이다.

## 10.1 REST 서비스를 이용한 앱 간 데이터 교환

- REST 엔드포인트는 단순히 두 앱 간 통신을 구현하는 방법이다.
- REST 서비스가 웹 앱 메커니즘과 유일하게 다른 점은 스프링 MVC 디스패처 서블릿이 뷰를 찾지 않는다는 것이다.
- 서버는 컨트롤러의 액션이 반환하는 것을 클라이언트에 대한 HTTP 응답으로 직접 전송한다.

> REST 엔드포인트에 수반될 수 있는 몇 가지 통신 문제
> - 컨트롤러 작업이 완료되는 데 오랜 시간이 소요된다면 엔드포인트에 대한 HTTP 호출이 타임아웃되어 통신이 중단될 수 있다.
> - HTTP 요청으로 한 번의 호출에 대량의 데이터를 전송하면 호출이 타임아웃되어 통신이 중단될 수 있다. REST 호출로 수 메가바이트 이상을 전송하는 것은 일반적으로 올바른 결정이 아니다.
> - 백엔드 컴포넌트로 노출된 엔드포인트에 대한 동시 호출이 과도하면 앱은 지나치게 많은 부하를 받아 실패할 수 있다.
> - 네트워크는 HTTP 호출을 지원하지만 네트워크가 100% 신뢰할 수 있는 것은 아니다. 네트워크 때문에 REST 엔드포인트 호출이 실패할 가능성은 항상 존재한다.

- REST를 사용하여 두 앱 간 통신을 구현할 때는 호출이 실패할 경우 발생할 수 있는 상황과 어떤 영향을 미칠 수 있는지 항상 고려해야 한다.

## 10.2 REST 엔드포인트 구현

- @ResponseBody 어노테이션은 컨트롤러의 액션이 뷰 이름이 아니라 HTTP 응답으로 직접 전송된 데이터를 반환한다는 것을 디스패처 서블릿에 알려 준다.
- @RestController 어노테이션을 사용하면 메소드마다 @ResponseBody 어노테이션을 반복할 필요 없다.
- 기본적으로 스프링 부트 앱은 8080번 포트에서 액세스할 수 있도록 톰캣 서블릿 컨테이너를 구성한다.

---

###  책에서 부록 A.3을 살펴보는 것을 추천하기에 부록 A.3 내용을 포함합니다.
## 부록 A.3 HTTP 기초 이해

### A.3.1 HTTP란 무엇인가?

- 클라이언트-서버 컴퓨팅 모델을 사용하는 상태를 유지하지 않는 무상태(stateless) 텍스트 기반의 요청-응답 프로토콜.

### A.3.2 클라이언트와 서버 간 언어로서 HTTP 요청

> HTTP 요청 시 고려해야 할 사항
> - 요청 URI: 클라이언트는 경로를 사용하여 서버에 요청하는 자원을 알린다.
> - 요청 메서드: 클라이언트가 요청한 자원에 대해 수행할 행동을 나타내는 동사다.
> - 요청 매개변수(비필수):클라이언트가 요청과 함께 서버로 보내는 소량의 데이터다. 소량은 대략 10~50자 정도를 표현할 수 있는 것을 의미한다.
> - 요청 헤더(비필수): 요청 헤더에서 소량으로 전송되는 데이터다. 요청 매개변수와 달리 이 값들은 URI에서 보이지 않는다.
> - 요청 본문(비필수): 클라이언트가 요청과 함께 서버로 전송하는 대량의 데이터다. 클라이언트가 문자 수백 개로 구성된 데이터를 보낼 때 HTTP 본문을 사용할 수 있다.

- URI는 URL과 path가 포함된다.
- URI = URL + path.
- 클라이언트가 요청에서 자원을 식별하면 HTTP 요청 메서드라고 하는 동사를 사용하여 자원에 대해 수행할 작업을 명시한다.

> 구현체가 동사에 제약받는 것은 아니라는 점을 항상 기억하라.
> 절대로 HTTP 메서드를 잘못 사용해서는 안 된다.
> 보안 및 유지 보수성을 확보하는 데 사용하는 HTTP 메서드 의미를 항상 고려해야 한다.

> 자주 사용되진 않지만 중요한 HTTP 메서드
> - OPTIONS: 서버가 요청에 대해 지원하는 매개변수 목록을 반환하도록 지시한다. 이 메서드를 사용하는 가장 흔한 기능은 보안 구현과 관련된 CORS이다.
> - PATCH: 서버 뒷단에서 특정 자원을 나타내는 데이터 일부만 변경될 때 사용할 수 있다.

### A.3.3 HTTP 응답: 서버가 응답하는 방식

> 클라이언트 요청에 대해 서버는 다음과 같이 응답한다.
> - 응답 상태: 요청 결과의 간단한 표현을 정의하는 100에서 599 사이의 정수다.
> - 응답 헤더(비필수): 요청 매개변수와 유사하게 키-값 쌍 데이터를 나타낸다. 클라이언트 요청에 대한 응답으로 서버에서 클라이언트로 소량의 데이터(10자~50자)를 보내는 데 사용된다.
> - 응답 본문(비필수): 서버가 클라이언트로 대량의 데이터를 보낼 수 있는 방법이다.

### A.3.4 HTTP 세션

- 서버가 동일한 클라이언트와 여러 번의 요청-응답에 대한 상호 작용 사이에 데이터를 저장할 수 있는 메커니즘이다.
- 백엔드는 클라이언트에 '세션 ID'라는 고유 식별자를 할당한 후 이를 앱 메모리의 특정 위치와 연결한다.

---

## 10.3 HTTP 응답 관리

- HTTP 응답은 클라이언트 요청에 따라 백엔드 앱이 클라이언트에 데이터를 재전송하는 방식이다.

> HTTP 응답에 포함되는 데이터
> - 응답 헤더: 응답에 포함된 작은 데이터 조각.(일반적으로 몇 개 단어 이하로 구성된다.)
> - 응답 본문: 백엔드에서 응답으로 보내야 하는 많은 양의 데이터.
> - 응답 상태: 요청 결과를 간략하게 표현한 내용.

### 10.3.1 객체를 응답 본문에 전송

- 두 앱 간에 전송되는 데이터를 모델링하려고 사용하는 객체를 데이터 전송 객체(DTO)라고 한다.
- 기본적으로 스프링은 객체의 문자열 표현을 생성하고 JSON 포맷으로 만든다.

### 10.3.2 응답 상태 및 헤더 설정

- ResponseEntity 클래스를 사용하여 응답 본문 값과 응답 상태 및 헤더를 모두 설정할 수 있다.

### 10.3.3 엔드포인트 수준에서 예외 관리

- @RestControllerAdvice 어노테이션을 사용하여 REST 컨트롤러 어드바이스를 정의할 수 있다.
- REST 컨트롤러 어드바이스는 @ExceptionHandler 어노테이션을 사용하여 컨트롤러 어드바이스 메서드를 트리거하는 예외를 지정할 수 있다.

> 프로덕션 앱에서는 컨트롤러의 액션에서 발생한 예외 정보를 어드바이스로 보내야 할 때가 있다. 이 때 처리되는 예외 타입에 대한 매개변수를 어드바이스의 예외 핸들러 메서드에 추가할 수 있다.

## 10.4 요청 본문을 사용하여 클라이언트의 데이터 가져오기

- HTTP GET 엔드포인트를 호출하는 데 요청 본문을 사용할 수 있도록 2014년에 HTTP 명세가 변경되었다.

## 10.5 요약

- REST 웹 서비는 두 애플리케이션 간 통신을 설정하는 간단한 방법이다.
- 스프링 앱에서 스프링 MVC 메커니즘은 REST 엔드포인트 구현을 지원한다. 메서드가 본문을 직접 반환하도록 지정하려면 @ResponseBody 어노테이션을 사용하거나, @RestController 어노테이션을 사용한다. 이 중 하나를 사용하지 않으면 디스패처 서블릿은 컨트롤러의 메서드가 뷰 이름을 반환한다고 가정하고 해당 뷰를 찾으려고 할 것이다.
- 컨트롤러 액션이 HTTP 응답 본문을 직접 반환하게 만들면, HTTP 상태 설정은 스프링의 기본 동작에 의존한다.
- 컨트롤러 액션이 ResponseEntity 인스턴스를 반환하게 만들면 HTTP 상태 및 헤더를 모두 관리할 수 있다.
- 예외를 관리하는 한 가지 방법은 컨트롤러의 액션 수준에서 직접 예외를 처리하는 것이다. 이렇게 하면 예외를 처리하는 데 사용되는 로직이 특정 컨트롤러 액션과 결합되어 중복이 발생할 수 있다. 이는 가장 피해야 할 일이다.
- 예외가 발생하는 경우 예외 실행 로직을 REST 컨트롤러 어드바이스 클래스를 사용하여 분리할 수 있다.
- 엔드포인트 HTTP 요청의 요청 매개변수, 경로 변수, HTTP 요청 본문을 통해 클라이언트에서 데이터를 가져올 수 있다.
