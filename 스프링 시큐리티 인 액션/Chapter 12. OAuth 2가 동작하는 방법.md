# Chapter 12. OAuth 2가 동작하는 방법

- 권한 부여 프레임워크(또는 사양 프레임워크라도 한다.)
- 타사 웹 사이트나 웹이 리소스에 접근할 수 있게 허용하는 것이 주 목적이다.
- 종종 위임 프로토콜이라고 부르기도 한다.

# OAuth2 구성요소

- 리소스 서버 - 사용자가 소유한 리소스를 호스팅하는 서버.
- 사용자 - 리소스 서버가 노출하는 리소스를 소유하는 개인.
- 클라이언트 - 사용자를 대신해 사용자가 소유한 리소스에 접근하는 애플리케이션.
- 권한 부여 서버 - 클라이언트가 리소스 서버가 노출하는 사용자의 리소스에 접근할 권한을 부여하는 애플리케이션

## 요약
- OAuth 2 프레임워크는 엔티티가 사용자 대신 리소스에 접근할 수 있게 하는 방법을 기술한다. 애플리케이션에 OAuth 2 프레임워크를 이용해 인증 및 권한 부여 논리를 구현할 수 있다.
- 애플리케이션이 액세스 토큰을 얻기 위해 사용할 수 있는 다양한 흐름을 **Grand**라고 한다. 시스템 아키텍처에 따라 적합한 Grant 유형을 선택해야 한다.
  - 승인 코드 그랜트 유형은 사용자가 직접 권한 부여 서버에서 인증하여 클라이언트가 액세스 토큰을 얻을 수 있게 해준다. 이 유형은 사용자가 클라이언트를 신뢰하지 않고 클라이언트와 자격 증명을 공유하기를 원하지 않을 때 적합하다.
  - 암호 그랜트 유형에서는 사용자가 자신의 자격 증명을 클라이언트와 공유한다가 가정한다. 클라이언트를 신뢰할 수 있는 경우에만 이 유형을 적용해야 한다.
  - 클라이언트 자격 증명 그랜트 유형은 클라이언트가 자격 증명으로만 인증하여 토큰을 얻는다는 의미다. 클라이언트가 사용자의 리소스가 아닌 리소스 서버의 엔드포인트를 호출해야 할 때 이 그랜트 유형을 선택한다.
- 스프링 시큐리티는 OAuth 2 프레임워크를 지원해서 애플리케이션에서 몇 줄의 코드로 프레임워크를 구성할 수 있다.
- 스프링 시큐리티는 ClientRegistration의 인스턴스를 이용해 권한 부여 서버에서 클라이언트의 등록을 나타낸다.
- 스프링 시큐리티 OAuth 2 구현에서 특정 클라이언트 등록을 찾는 책임이 있는 구성 요소를 ClientRegistrationRepository라고 한다. 스프링 시큐리티로 OAuth 2 클라이언트를 구현할 때는 사용 가능한 ClientRegistration이 하나 이상 있는 ClientRegistrationRepository 객체를 정의해야 한다.
